function N(E){const G={$near:(b,k)=>{const{latitude:w,longitude:z,radius:j}=k,C=b?.latitude,f=b?.longitude;if(typeof C!=="number"||typeof f!=="number")return!1;return H(C,f,w,z)<=j},$bbox:(b,k)=>{const{minLat:w,maxLat:z,minLng:j,maxLng:C}=k,f=b?.latitude,A=b?.longitude;if(typeof f!=="number"||typeof A!=="number")return!1;return f>=w&&f<=z&&A>=j&&A<=C}};function H(b,k,w,z){const j=(J)=>J*Math.PI/180,f=j(w-b),A=j(z-k),F=Math.sin(f/2)*Math.sin(f/2)+Math.cos(j(b))*Math.cos(j(w))*Math.sin(A/2)*Math.sin(A/2);return 6371*(2*Math.atan2(Math.sqrt(F),Math.sqrt(1-F)))}const I=E.map;return E.map=async function(...b){const k=await I.call(this,...b);if(b.find((z)=>typeof z==="object")?.query)Object.assign(E.operators,G);return k},E}export{N as withGeolocationOperators};
