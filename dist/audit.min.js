async function E(O){try{const h=await fetch("https://text.pollinations.ai/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You are an assistant specialized in analyzing Oplog data."},{role:"user",content:O}],model:"openai",seed:Math.floor(Math.random()*1000),jsonMode:!0})});if(!h.ok)throw new Error(`\u274C Pollinations API error: ${h.statusText}`);const z=await h.json();try{return typeof z==="string"?JSON.parse(z):z}catch{return z}}catch(k){throw console.error("\u274C Error processing prompt with API:",k.message),k}}function I(O,k,h={}){console.log("\uD83E\uDDE0 AI Audit module loaded."),console.log(`\uD83E\uDDE0 AI Audit Prompt: \x1B[32m${h.prompt}\x1B[0m`);let z=null;function x(w){if(z)z();z=((O.map?.(({id:j,value:H,action:B})=>{if(B==="added"||B==="updated"||B==="initial")G(O,w)}))??{unsubscribe:()=>{}}).unsubscribe}return x(h.prompt),{stop:()=>z?.()}}var C=(O,k=500)=>{let h;return(...z)=>{clearTimeout(h),h=setTimeout(()=>O(...z),k)}},F=async(O,k="Flag offensive/prohibited content and consecutive entries with timestamps <150ms apart.")=>{console.log("\uD83D\uDEE1\uFE0F Audit: analizing Oplog data");const h=O.oplog.getDelta(null),z=[];for(let v of h)try{const{result:j}=await O.get(v.id);if(j&&j.value)z.push({id:v.id,timestamp:v.timestamp,type:v.type,value:j.value})}catch(j){}const x=`
    You are an assistant specialized in analyzing Oplog data.

    Analyze the following array of JSON objects called "elements":
    ${JSON.stringify(z,null,2)}

    Use the following criteria:
    "${k}"

    Rules:
    - Return ONLY a JSON object with a property "list", which is an array of objects containing the IDs of the elements that meet the criteria.
    - If an element does NOT meet the criteria, do NOT include its ID.
    - Do NOT modify the original objects.

    Example output format:
    {
      "list": [
        { "id": "<id>" }
      ]
    }
  `,w=await E(x);if(w.list&&Array.isArray(w.list))for(let v of w.list){const j=v.id??v;O.remove?.(j),O.oplog?.remove?.(j),console.info(`\uD83E\uDDE0 AI Audit: Node deleted by audit \u2192 ${j}`)}},G=C(F,500);export{I as init,C as debounce};
